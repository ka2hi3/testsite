<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>幻想的な雪の夜</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: linear-gradient(to top, #1a1a2e, #000000);
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="snowCanvas"></canvas>

  <script>
    const canvas = document.getElementById("snowCanvas");
    const ctx = canvas.getContext("2d");
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;

    const snowflakes = [];
    const stars = [];

    const colors = ["#ffffff", "#aee9ff", "#ffd1dc", "#ffe066", "#b5f5ec", "#ffb3ff"];

    function createSnowflake() {
      const size = Math.random() * 6 + 4;
      return {
        x: Math.random() * width,
        y: Math.random() * height,
        size,
        speedY: (Math.random() * 1 + 0.5) * 0.5, // ← 雪の速度を半分に
        angle: Math.random() * Math.PI * 2,
        swing: Math.random() * 1 + 0.5,
        color: colors[Math.floor(Math.random() * colors.length)],
      };
    }

    function drawSnowflake(snow) {
      ctx.save();
      ctx.translate(snow.x, snow.y);
      ctx.rotate(snow.angle);
      ctx.strokeStyle = snow.color;
      ctx.lineWidth = 1;
      ctx.beginPath();
      for (let i = 0; i < 6; i++) {
        ctx.moveTo(0, 0);
        ctx.lineTo(0, -snow.size);
        ctx.rotate(Math.PI / 3);
      }
      ctx.stroke();
      ctx.restore();
    }

    function createStar(x, y, angle) {
      const speed = Math.random() * 2 + 1;
      return {
        x,
        y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        size: 6,
        life: 60
      };
    }

    function drawStar(star) {
      ctx.save();
      ctx.translate(star.x, star.y);
      ctx.fillStyle = "#ffffcc";
      ctx.beginPath();
      for (let i = 0; i < 5; i++) {
        ctx.lineTo(
          Math.cos((18 + i * 72) * Math.PI / 180) * star.size,
          -Math.sin((18 + i * 72) * Math.PI / 180) * star.size
        );
        ctx.lineTo(
          Math.cos((54 + i * 72) * Math.PI / 180) * (star.size / 2),
          -Math.sin((54 + i * 72) * Math.PI / 180) * (star.size / 2)
        );
      }
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function animate() {
      ctx.clearRect(0, 0, width, height);

      for (let snow of snowflakes) {
        snow.y += snow.speedY;
        snow.x += Math.sin(snow.angle) * snow.swing * 0.3;
        snow.angle += 0.01;
        if (snow.y > height) {
          snow.y = -snow.size;
          snow.x = Math.random() * width;
        }
        drawSnowflake(snow);
      }

      for (let i = stars.length - 1; i >= 0; i--) {
        const star = stars[i];
        star.x += star.vx;
        star.y += star.vy;
        drawStar(star);
        star.size *= 0.95;
        star.life--;
        if (star.life <= 0) {
          stars.splice(i, 1);
        }
      }

      requestAnimationFrame(animate);
    }

    for (let i = 0; i < 150; i++) {
      snowflakes.push(createSnowflake());
    }

    canvas.addEventListener("click", (e) => {
      const x = e.clientX;
      const y = e.clientY;

      // 星を20個、放射状に生成
      for (let i = 0; i < 20; i++) {
        const angle = (Math.PI * 2 / 20) * i + (Math.random() * 0.2 - 0.1); // 少しばらつき
        stars.push(createStar(x, y, angle));
      }

      // 雪を風で舞わせる
      for (let snow of snowflakes) {
        const dx = snow.x - x;
        const dy = snow.y - y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 120) {
          snow.x += dx * 0.2;
          snow.y += dy * 0.2;
        }
      }
    });

    window.addEventListener("resize", () => {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    });

    animate();
  </script>
</body>
</html>
